<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script type="module">
      import Hexes from "../src/index.js";

      let grid = Hexes.createGrid({ radius: 1, layout: "flat" });

      const player = Hexes.createEntity({
        player: true,
        health: 100,
        attack: 15,
      });

      const enemy = Hexes.createEntity({
        enemy: true,
        health: 90,
        attack: 15,
      });

      const enemy2 = Hexes.createEntity({
        enemy: true,
        health: 80,
        attack: 15,
      });

      const potion = Hexes.createEntity({
        potion: true,
        healAmount: 25,
      });

      grid = Hexes.setCellData(grid, { x: -1, y: 0, z: 1 }, player, potion);
      grid = Hexes.setCellData(grid, { x: 1, y: 0, z: -1 }, enemy);
      grid = Hexes.setCellData(grid, { x: 0, y: 0, z: 0 }, enemy2);

      const enemyEnts = Hexes.query(grid, "health").filter((ent) => {
        const [cell, entity] = ent;

        if (entity.health < 100) {
          return entity;
        }
      });

      function move(grid, ent, destination) {
        const [cell, entity] = Hexes.query(grid, "id").filter(
          (e) => e[1].id === ent.id
        )[0];
        const unitCoord = cell.coord;
        const removedUnitGrid = Hexes.removeCellData(grid, unitCoord, entity);

        return Hexes.setCellData(removedUnitGrid, destination, entity);
      }

      grid = move(grid, player, { x: 0, y: -1, z: 1 });
      grid = move(grid, enemy2, { x: 0, y: 0, z: 0 });

      const gridForDisplay = {
        ...grid,
        cells: Array.from(grid.cells.entries()),
      };
      document.getElementById("code").innerHTML = JSON.stringify(
        gridForDisplay,
        null,
        2
      );
    </script>
  </head>
  <body>
    <pre><code id="code"></code></pre>
  </body>
</html>
